# Command Interface Contract

**Version**: 1.0.0
**Date**: 2025-01-13

## Overview

This document defines the contract for the `make:crud` artisan command interface. This is the primary API for developers using the package.

## Command Signature

```bash
php artisan make:crud {resource} {fields?*} {options}
```

### Arguments

#### `resource` (required)

- **Type**: String
- **Description**: The name of the resource to generate CRUD for (e.g., "Product", "UserProfile")
- **Format**: PascalCase or any case (will be converted to PascalCase)
- **Validation**:
  - Must start with a letter
  - Alphanumeric characters only
  - Length: 1-50 characters
  - Must not be a reserved PHP word (File, Directory, Exception, etc.)
- **Examples**:
  - `Product`
  - `UserProfile`
  - `BlogPost`

#### `fields` (optional, multiple)

- **Type**: String array
- **Description**: Field definitions in format `name:type[:modifier1[:modifier2]]`
- **Format**: `fieldname:datatype[:nullable][:unique]`
- **Validation**:
  - Field name: lowercase, starts with letter, alphanumeric + underscore
  - Data type: must be supported type (string, text, integer, decimal, boolean, date, datetime, timestamp, json)
  - Modifiers: nullable, unique (can be combined)
- **Examples**:
  - `name:string`
  - `email:string:unique`
  - `description:text:nullable`
  - `slug:string:unique:nullable`
  - `price:decimal`
  - `is_active:boolean`
  - `published_at:datetime:nullable`

### Options

#### `--no-soft-deletes`

- **Type**: Boolean flag
- **Default**: false (soft deletes enabled by default)
- **Description**: Disable SoftDeletes trait in generated Model
- **Effect**:
  - Model does not include `use SoftDeletes;`
  - Migration does not include `$table->softDeletes();`
  - Controller does not filter `->withTrashed()` or `->onlyTrashed()`

#### `--no-auditing`

- **Type**: Boolean flag
- **Default**: false (auditing enabled by default)
- **Description**: Disable Auditable contract in generated Model
- **Effect**:
  - Model does not implement `Auditable` interface
  - Model does not include `use \OwenIt\Auditing\Auditable;`
  - No audit trail configuration in Model

#### `--no-views`

- **Type**: Boolean flag
- **Default**: false (views generated by default)
- **Description**: Skip Vue file generation, backend only
- **Effect**:
  - Generates only: Model, Controller, Requests, Resource (5 files)
  - Skips: Index.vue, Create.vue, Edit.vue, Form.vue (4 files)

#### `--table=`

- **Type**: String
- **Default**: null (auto-computed as snake_case plural of resource name)
- **Description**: Custom table name override
- **Validation**: Valid SQL identifier (snake_case, alphanumeric + underscore)
- **Example**: `--table=inventory_products`

#### `--force`

- **Type**: Boolean flag
- **Default**: false
- **Description**: Overwrite existing files without prompting
- **Effect**: If files exist, they will be replaced without confirmation

#### `--quiet` (Symfony Console standard)

- **Type**: Boolean flag
- **Default**: false
- **Description**: Suppress all output except errors
- **Effect**: No progress messages, only errors displayed
- **Mutually Exclusive**: Cannot be used with `--verbose`

#### `--verbose` or `-v` (Symfony Console standard)

- **Type**: Boolean flag
- **Default**: false
- **Description**: Enable detailed step-by-step logging
- **Effect**: Shows file operations, token replacements, validation steps
- **Mutually Exclusive**: Cannot be used with `--quiet`

#### `--with-tests`

- **Type**: Boolean flag
- **Default**: false
- **Description**: Generate Pest test stubs for the resource
- **Effect**: Creates test files in `tests/Feature/{Resource}Test.php`

#### Relationship Options (Phase 3 - Future)

#### `--belongs-to=`

- **Type**: String (comma-separated)
- **Default**: null
- **Description**: Define belongsTo relationships
- **Format**: `ModelName` or `ModelName:customMethodName`
- **Example**: `--belongs-to=User,Category`

#### `--has-many=`

- **Type**: String (comma-separated)
- **Default**: null
- **Description**: Define hasMany relationships
- **Format**: `ModelName` or `ModelName:customMethodName`
- **Example**: `--has-many=Comment,Attachment`

#### `--has-one=`

- **Type**: String (comma-separated)
- **Default**: null
- **Description**: Define hasOne relationships
- **Format**: `ModelName` or `ModelName:customMethodName`
- **Example**: `--has-one=Profile`

#### `--morph-many=`

- **Type**: String (comma-separated)
- **Default**: null
- **Description**: Define morphMany relationships
- **Format**: `relationshipName:morphName`
- **Example**: `--morph-many=comments:commentable`

## Usage Examples

### Basic CRUD Generation

```bash
php artisan make:crud Product name:string price:decimal description:text:nullable
```

**Output**: 9 files created (Model, Controller, 2 Requests, Resource, 4 Vue files)

### Backend-Only Generation

```bash
php artisan make:crud Product name:string price:decimal --no-views
```

**Output**: 5 files created (Model, Controller, 2 Requests, Resource)

### Simple Resource without Auditing

```bash
php artisan make:crud Category name:string:unique slug:string:unique --no-auditing
```

**Output**: 9 files, Model does not implement Auditable

### Custom Table Name

```bash
php artisan make:crud Product name:string price:decimal --table=inventory_products
```

**Output**: 9 files, Model specifies `protected $table = 'inventory_products';`

### Quiet Mode for CI/CD

```bash
php artisan make:crud Product name:string price:decimal --quiet
```

**Output**: Silent unless errors occur

### Verbose Mode for Debugging

```bash
php artisan make:crud Product name:string price:decimal --verbose
```

**Output**: Detailed step-by-step logging

### Force Overwrite

```bash
php artisan make:crud Product name:string price:decimal --force
```

**Output**: Overwrites existing files without confirmation

### Complex Fields with Modifiers

```bash
php artisan make:crud User name:string email:string:unique:nullable password:string phone:string:nullable is_admin:boolean created_at:timestamp
```

**Output**: 9 files with proper nullable/unique handling

## Exit Codes

| Code | Meaning | Description |
|------|---------|-------------|
| 0 | Success | All files generated successfully |
| 1 | Validation Error | Invalid resource name, field definition, or options |
| 2 | Generation Error | File write failure, rollback performed |
| 3 | Configuration Error | Package not configured correctly |

## Output Format

### Normal Mode

```
Generating CRUD for Product...
✓ Model created: app/Models/Product.php
✓ Controller created: app/Http/Controllers/ProductController.php
✓ StoreRequest created: app/Http/Requests/Product/StoreRequest.php
✓ UpdateRequest created: app/Http/Requests/Product/UpdateRequest.php
✓ Resource created: app/Http/Resources/ProductResource.php
✓ Index page created: resources/js/pages/products/Index.vue
✓ Create page created: resources/js/pages/products/Create.vue
✓ Edit page created: resources/js/pages/products/Edit.vue
✓ Form component created: resources/js/pages/products/components/Form.vue

✓ CRUD generation completed successfully (9 files created in 2.34s)

Next steps:
  1. Run migrations: php artisan migrate
  2. Add routes to routes/web.php
  3. Register Inertia route in app/Http/Middleware/HandleInertiaRequests.php
```

### Quiet Mode

```
[No output unless error]
```

### Verbose Mode

```
Validating resource name: Product
✓ Resource name is valid (PascalCase)

Parsing field definitions...
✓ Field: name (type: string, modifiers: [])
✓ Field: price (type: decimal, modifiers: [])
✓ Field: description (type: text, modifiers: [nullable])

Loading configuration...
✓ Config loaded: /path/to/config/crud-generator.php

Loading stub templates...
✓ Loaded: resources/stubs/model.stub (1,234 bytes)
✓ Loaded: resources/stubs/controller.stub (2,456 bytes)
... [all 9 stubs]

Rendering Model...
✓ Token replaced: {{ NAMESPACE }} → App\Models
✓ Token replaced: {{ RESOURCE_NAME }} → Product
✓ Token replaced: {{ TABLE_NAME }} → products
✓ Model rendered (1,456 bytes)

Writing Model...
✓ Written: app/Models/Product.php (1,456 bytes)

... [repeat for all files]

Atomic generation successful: 9 files committed
Total time: 2.34s
```

## Error Handling

### Validation Errors

```bash
php artisan make:crud 123Invalid
```

**Output**:
```
✗ Error: Invalid resource name "123Invalid"
  Resource name must start with a letter and contain only alphanumeric characters.

Example: php artisan make:crud Product name:string price:decimal
```

### Field Definition Errors

```bash
php artisan make:crud Product name:invalidtype
```

**Output**:
```
✗ Error: Invalid field type "invalidtype" for field "name"
  Supported types: string, text, integer, decimal, boolean, date, datetime, timestamp, json

Example: php artisan make:crud Product name:string price:decimal
```

### Generation Errors with Rollback

```bash
php artisan make:crud Product name:string
# [Simulated: disk full during Controller write]
```

**Output**:
```
Generating CRUD for Product...
✓ Model created: app/Models/Product.php
✗ Error: Failed to write file app/Http/Controllers/ProductController.php
  Reason: Disk full

Rolling back changes...
✓ Deleted: app/Models/Product.php

✗ CRUD generation failed. No files were created.
```

## Backward Compatibility

- **Version 1.0.0**: Initial release
- **Future versions**: New options will be added with sensible defaults to maintain backward compatibility
- **Breaking changes**: Will increment major version (2.0.0)

## Testing Contract

Package test suite validates:

1. **Command Signature**: Correct argument and option parsing
2. **Field Parsing**: All field type and modifier combinations
3. **Option Handling**: Each flag correctly affects generated code
4. **Output Levels**: Normal, quiet, and verbose modes produce expected output
5. **Error Messages**: Clear, actionable error messages for all failure modes
6. **Exit Codes**: Correct exit code for each scenario
7. **Rollback**: Atomic generation ensures no partial state on failure
